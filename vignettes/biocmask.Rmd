---
title: "`biocmask` Usage Guide"
author:
    - name: Justin Landis
      orcid: 0000-0001-5501-4934
    - name: Michael Love
      orcid: 0000-0001-8401-0545
date: "`r format(Sys.time(), '%m/%d/%Y')`"
output: rmarkdown::html_document
abstract: >
  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec auctor velit lectus, nec hendrerit metus aliquet sit amet. Integer in porta quam. Quisque sit amet lectus orci. Sed vel eros justo. Aliquam erat volutpat. Sed ac nibh finibus, tempor enim id, pellentesque tortor. Nullam congue egestas sapien sed vestibulum. Aliquam erat volutpat. Duis gravida dignissim orci eu sodales. Proin non ullamcorper metus. 
bibliography: library.bib
vignette: |
  %\VignetteIndexEntry{biocmask Usage Guide}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Quick start

`biocmask` provides efficient abstractions to the *SummarizedExperiment* such
that using common dplyr functions feels as natural to operating on a
*data.frame* or *tibble*. `biocmask` uses 
[data-masking](https://rlang.r-lib.org/reference/topic-data-mask-programming.html) 
from the `rlang` package in order to connect dplyr functions to
*SummarizedExperiment* slots in a manner that aims to be intuitive and avoiding
ambiguity in outcomes.

## Supported data types and operations

`biocmask` works on *SummarizedExperiment* objects, as well as most
classes derived from this, including *DESeqDataSet*,
*SingleCellExperiment*, etc.

It supports the following operations:

* `mutate`
* `select`
* ...

## Typical use case

```{r message=FALSE}
library(airway)
data(airway)
library(dplyr)
library(biocmask)
# add content (mutate) to any of the three tables:
# assay, colData, rowData
# ...using contextual helpers cols() and rows()
airway |>
  mutate(log_counts = log1p(counts),
         cols(treated = dex == "trt"),
         rows(new_id = paste0("gene-", gene_name)))
```

The operations can span contexts, and only the necessary data will be extracted
from each context for computation:

```{r}
airway$sizeFactor <- runif(8, .9, 1.1)
airway |>
  mutate(scaled_counts = t(t(counts) / .cols_asis$sizeFactor),
         rows(mean_scaled_counts = rowMeans(.assays_asis$scaled_counts)))

airway |>
  #identical as before, but let the `.cols$` pronoun reshape
  # the data to fit the assays context
  mutate(scaled_counts = counts / .cols$sizeFactor,
         rows(mean_scaled_counts = rowMeans(.assays_asis$scaled_counts)))
```

Alternatively we could have used *purrr* to compute row sums:

```{r}
airway |>
  mutate(scaled_counts = counts / .cols$sizeFactor,
         # the non-"_asis" pronouns will try to reshape the data for the
         # current context. You may expect a list of slices from `.assays$`
         # and a replicated list
         rows(mean_scaled_counts = purrr::map_dbl(.assays$counts, sum)))
```

See below for details on how objects are made available across contexts.

We can perform grouping and summarization:

```{r}
airway |>
  group_by(rows(gene_biotype)) |>
  summarize(col_sums = colSums(counts))
```

## Related work

* these
* are 
* some 
* others

# Manipulating *SummarizedExperiment* with `biocmask`

Put your diagrams here, those are great. They can go in `/images`

## assay context

## row context

## col context

# Advanced features

What is super cool and you want to show advanced users

# Troubleshooting and best practices

Any tips on how to get started, or how to write things most efficiently?

# Community and support

I can put stuff in here

# Session info

```{r}
devtools::session_info()
```

# References
